<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Number of resolved claims</title>
    <meta name="description" content="My Page Description">
    <link rel="stylesheet" href="css/styles.css?v=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js" integrity="sha512-hnFpvCiJ8Fr1lYLqcw6wLgFUOEZ89kWCkO+cEekwcWPIPKyknKV1eZmSSG3UxXfsSuf+z/SgmiYB1zFOg3l2UQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<style>
    #chart, #title {
        text-align: center;
        margin-top: 40px;
    }
</style>
<body>
  <div id="title"> Number of resolved claims </div>
  <div id="chart"></div>
  <script type="text/javascript">
      // Fake data
      var rawData = [
          ["1636416000000", 1],
          ["1636588800000", 1],
          ["1636675200000", 1],
          ["1636934400000", 1],
          ["1637020800000", 2],
          ["1637280000000", 2],
          ["1637452800000", 1],
          ["1637539200000", 3],
          ["1637712000000", 3],
          ["1637798400000", 2],
          ["1638057600000", 1],
          ["1638144000000", 1],
          ["1638230400000", 3],
          ["1638403200000", 1],
          ["1638489600000", 3],
          ["1638662400000", 3],
          ["1639008000000", 3],
          ["1639094400000", 1],
          ["1639267200000", 3],
          ["1639353600000", 1],
          ["1639526400000", 1],
          ["1639612800000", 1],
          ["1639699200000", 2],
          ["1639785600000", 3],
          ["1639872000000", 3],
          ["1639958400000", 2],
          ["1640131200000", 1],
          ["1640217600000", 3],
          ["1640390400000", 4],
          ["1640476800000", 1],
          ["1640563200000", 3],
          ["1640736000000", 2],
          ["1640822400000", 1],
          ["1640995200000", 1],
          ["1641081600000", 2],
          ["1641168000000", 4],
          ["1641254400000", 5],
          ["1641340800000", 3],
          ["1641427200000", 6],
          ["1641513600000", 4],
          ["1641600000000", 2],
          ["1641686400000", 3],
          ["1641772800000", 3],
          ["1641859200000", 3],
          ["1641945600000", 4],
          ["1642032000000", 5],
          ["1642118400000", 3],
          ["1642204800000", 3],
          ["1642291200000", 5],
          ["1642377600000", 4],
          ["1642464000000", 3],
          ["1642550400000", 3],
          ["1642636800000", 5],
          ["1642723200000", 7],
          ["1642809600000", 2],
          ["1642896000000", 1],
          ["1642982400000", 5],
          ["1643068800000", 7],
          ["1643155200000", 2],
          ["1643241600000", 10],
          ["1643328000000", 4],
          ["1643414400000", 8],
          ["1643500800000", 4],
          ["1643587200000", 2],
          ["1643673600000", 8],
          ["1643760000000", 4],
          ["1643846400000", 6],
          ["1643932800000", 3],
          ["1644019200000", 1],
          ["1644105600000", 4],
          ["1644192000000", 5],
          ["1644278400000", 4],
          ["1644364800000", 5],
          ["1644451200000", 2],
          ["1644537600000", 7],
          ["1644624000000", 2],
          ["1644710400000", 4],
          ["1644796800000", 9],
          ["1644883200000", 5],
          ["1644969600000", 6],
          ["1645056000000", 5],
          ["1645142400000", 9],
          ["1645228800000", 10],
          ["1645315200000", 9],
          ["1645401600000", 14],
          ["1645488000000", 13],
          ["1645574400000", 10],
          ["1645660800000", 11],
          ["1645747200000", 5],
          ["1645833600000", 7],
          ["1645920000000", 7],
          ["1646006400000", 13],
          ["1646092800000", 11],
          ["1646179200000", 11],
          ["1646265600000", 7],
          ["1646352000000", 10],
          ["1646438400000", 7],
          ["1646524800000", 3],
          ["1646611200000", 7],
          ["1646697600000", 13],
          ["1646784000000", 4],
          ["1646870400000", 12],
          ["1646956800000", 8],
          ["1647043200000", 3],
          ["1647129600000", 2],
          ["1647216000000", 14],
          ["1647302400000", 13],
          ["1647388800000", 13],
          ["1647475200000", 7],
          ["1647561600000", 6],
          ["1647648000000", 7],
          ["1647734400000", 4],
          ["1647820800000", 15],
          ["1647907200000", 3],
          ["1647993600000", 10],
          ["1648080000000", 5],
          ["1648166400000", 6],
          ["1648252800000", 1],
          ["1648339200000", 4],
          ["1648425600000", 10],
          ["1648512000000", 10],
          ["1648598400000", 10],
          ["1648684800000", 7],
          ["1648771200000", 8],
          ["1648857600000", 5],
          ["1648944000000", 8],
          ["1649030400000", 24],
          ["1649116800000", 11],
          ["1649203200000", 14],
          ["1649289600000", 9],
          ["1649376000000", 8],
          ["1649462400000", 4],
          ["1649548800000", 6],
          ["1649635200000", 16],
          ["1649721600000", 8],
          ["1649808000000", 5],
          ["1649894400000", 12],
          ["1649980800000", 3],
          ["1650067200000", 3],
          ["1650153600000", 2],
          ["1650240000000", 6],
          ["1650326400000", 15],
          ["1650412800000", 26],
          ["1650499200000", 32],
          ["1650585600000", 38],
          ["1650672000000", 15],
          ["1650758400000", 11],
          ["1650844800000", 56],
          ["1650931200000", 24],
          ["1651017600000", 46],
          ["1651104000000", 24],
          ["1651190400000", 35],
          ["1651276800000", 13],
          ["1651363200000", 14],
          ["1651449600000", 30],
          ["1651536000000", 34],
          ["1651622400000", 28],
          ["1651708800000", 42],
          ["1651795200000", 41],
          ["1651881600000", 16],
          ["1651968000000", 15],
          ["1652054400000", 33],
          ["1652140800000", 47],
          ["1652227200000", 25],
          ["1652313600000", 31],
          ["1652400000000", 25],
          ["1652486400000", 8],
          ["1652572800000", 18],
          ["1652659200000", 50],
          ["1652745600000", 43],
          ["1652832000000", 46],
          ["1652918400000", 36],
          ["1653004800000", 33],
          ["1653091200000", 16],
          ["1653177600000", 24],
          ["1653264000000", 39],
          ["1653350400000", 37],
          ["1653436800000", 29],
          ["1653523200000", 19],
          ["1653609600000", 51],
          ["1653696000000", 14],
          ["1653782400000", 25],
          ["1653868800000", 39],
          ["1653955200000", 23],
          ["1654041600000", 34],
          ["1654128000000", 39],
          ["1654214400000", 40],
          ["1654300800000", 11],
          ["1654387200000", 14],
          ["1654473600000", 16],
          ["1654560000000", 40],
          ["1654646400000", 33],
          ["1654732800000", 55],
          ["1654819200000", 27],
          ["1654905600000", 16],
          ["1654992000000", 13],
          ["1655078400000", 31],
          ["1655164800000", 46],
          ["1655251200000", 28],
          ["1655337600000", 18],
          ["1655424000000", 37],
          ["1655510400000", 17],
          ["1655596800000", 20],
          ["1655683200000", 52],
          ["1655769600000", 28],
          ["1655856000000", 37],
          ["1655942400000", 70],
          ["1656028800000", 27],
          ["1656115200000", 23],
          ["1656201600000", 20],
          ["1656288000000", 33],
          ["1656374400000", 29],
          ["1656460800000", 54],
          ["1656547200000", 47],
          ["1656633600000", 29],
          ["1656720000000", 21],
          ["1656806400000", 21],
          ["1656892800000", 46],
          ["1656979200000", 32],
          ["1657065600000", 43],
          ["1657152000000", 37],
          ["1657238400000", 51],
          ["1657324800000", 17],
          ["1657411200000", 24],
          ["1657497600000", 45],
          ["1657584000000", 4],
      ];

      const data = rawData.sort((a, b) => a[0] < b[0]).slice(rawData.length - 30);

      // Create SVG and padding for the chart
      const svg = d3
          .select("#chart")
          .append("svg")
          .attr("height", 300)
          .attr("width", 600);
      const margin = { top: 0, bottom: 20, left: 30, right: 20 };
      const chart = svg.append("g").attr("transform", `translate(${margin.left},0)`);
      const width = +svg.attr("width") - margin.left - margin.right;
      const height = +svg.attr("height") - margin.top - margin.bottom;
      const grp = chart
          .append("g")
          .attr("transform", `translate(-${margin.left},-${margin.top})`);

      // Add empty scales group for the scales to be attatched to on update
      chart.append("g").attr("class", "x-axis");
      chart.append("g").attr("class", "y-axis");

      // Add empty path
      const path = grp
          .append("path")
          .attr("transform", `translate(${margin.left},0)`)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-linejoin", "round")
          .attr("stroke-linecap", "round")
          .attr("stroke-width", 1.5);

      function updateScales(data) {
          // Create scales
          const yScale = d3
              .scaleLinear()
              .range([height, 0])
              .domain([0, d3.max(data, (dataPoint) => dataPoint[1])]);
          const xScale = d3
              .scaleLinear()
              .range([0, width])
              .domain(d3.extent(data, (dataPoint) => dataPoint[0]));
          return { yScale, xScale };
      }

      function createLine(xScale, yScale) {
          return (line = d3
              .line()
              .x((dataPoint) => xScale(dataPoint[0]))
              .y((dataPoint) => yScale(dataPoint[1])));
      }

      function updateAxes(data, chart, xScale, yScale) {
          chart
              .select(".x-axis")
              .attr("transform", `translate(0,${height})`)
              .call(d3.axisBottom(xScale).ticks(data.length));
          chart
              .select(".y-axis")
              .attr("transform", `translate(0, 0)`)
              .call(d3.axisLeft(yScale));
      }

      function updatePath(data, line) {
          const updatedPath = d3.select("path").interrupt().datum(data).attr("d", line);

          const pathLength = updatedPath.node().getTotalLength();
          // D3 provides lots of transition options, have a play around here:
          // https://github.com/d3/d3-transition
          const transitionPath = d3.transition().ease(d3.easeSin).duration(10000);
          updatedPath
              .attr("stroke-dashoffset", pathLength)
              .attr("stroke-dasharray", pathLength)
              .transition(transitionPath)
              .attr("stroke-dashoffset", 0);
      }

      function updateChart(data) {
          const { yScale, xScale } = updateScales(data);
          const line = createLine(xScale, yScale);
          // updateAxes(data, chart, xScale, yScale);
          updatePath(data, line);
      }

      updateChart(data);
      // // Update chart when button is clicked
      // d3.select("button").on("click", () => {
      //   // Create new fake data
      //   const newData = data.map((row) => {
      //     return { ...row, [1]: row[1] * Math.random() };
      //   });
      //   updateChart(newData);
      // });

  </script>
</body>
</html>